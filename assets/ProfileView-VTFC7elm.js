import{d as U,c as l,p as A,l as x,n as B,o as n,b as F,s as M,r as u,y as Y,a as e,f as j,v as C,q as D,t as c,w as z,g,F as b,z as $,m as J,i as I,x as m}from"./index-BMWppYuZ.js";import{_ as O}from"./SelectFilter.vue_vue_type_script_setup_true_lang-D159y7WP.js";import{L as G}from"./LoadingAnimation-bgBTrPG_.js";import{_ as H}from"./lodash-eEi3ECrh.js";const K={key:0,class:"inline-block"},Q={key:1,class:"inline-block w-5"},E=U({__name:"SaveButton",props:{loading:{type:Boolean},dirty:{type:Boolean}},setup(r){return(t,a)=>(n(),l("span",{title:"Save",class:B([t.dirty?"bg-yellow-200 hover:bg-yellow-300":"","flex flex-col justify-center rounded-sm px-2 py-1"])},[t.loading===!1?(n(),l("button",K,[A(t.$slots,"default")])):(n(),l("span",Q,[x(G)]))],2))}});class _ extends Error{}_.prototype.name="InvalidTokenError";function W(r){return decodeURIComponent(atob(r).replace(/(.)/g,(t,a)=>{let i=a.charCodeAt(0).toString(16).toUpperCase();return i.length<2&&(i="0"+i),"%"+i}))}function X(r){let t=r.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return W(t)}catch{return atob(t)}}function Z(r,t){if(typeof r!="string")throw new _("Invalid token specified: must be a string");t||(t={});const a=t.header===!0?0:1,i=r.split(".")[a];if(typeof i!="string")throw new _(`Invalid token specified: missing part #${a+1}`);let v;try{v=X(i)}catch(p){throw new _(`Invalid token specified: invalid base64 for part #${a+1} (${p.message})`)}try{return JSON.parse(v)}catch(p){throw new _(`Invalid token specified: invalid json for part #${a+1} (${p.message})`)}}const ee=e("h1",{class:"bg-neutral-700 p-4 text-2xl font-bold text-neutral-300"},"My Profile",-1),te={class:"w-full"},se={class:"flex flex-col"},oe={class:"flex items-center justify-between"},le={class:"mt-4"},ne=e("h2",{class:"p-4 text-2xl font-bold text-neutral-900"},"Preferences",-1),ae={class:"flex flex-col p-4 md:min-w-96 md:items-start md:justify-center"},re={class:"flex flex-col"},ie=e("label",{class:"text-neutral-700"},"Default Supplier",-1),de={class:"flex gap-1"},ue=e("h2",{class:"p-4 text-2xl font-bold text-neutral-900"},"Refresh Session",-1),ce={class:"px-4"},fe={class:"flex items-center justify-between"},pe={key:0,class:"flex w-full flex-col"},me={class:"border-1 m-1 border bg-yellow-100 p-2"},_e=e("h3",{class:"text-2xl font-bold"},"Local Debugging",-1),ve=e("p",null," You are currently running the application in local development mode. This means that you are not connected to the production database. You can still use the application, but you will not see any data from the production database. ",-1),he=e("h4",{class:"text-l mt-4 font-bold underline"},"Session Data",-1),ge=e("h4",{class:"text-l mt-4 font-bold underline"},"session.user",-1),be=e("h4",{class:"text-l mt-4 font-bold underline"},"decoded session.access_token",-1),Se=U({__name:"ProfileView",setup(r){var V;const t=F(),{firstName:a,lastName:i,preferences:v,isLocal:p,session:h}=M(t),y=u(!1),w=u(!1),L=Y(()=>{var f;return(f=h.value)!=null&&f.access_token?Z(h.value.access_token):{}}),k=u(a.value),S=u(i.value),N=u((V=v.value)==null?void 0:V.defaultSupplier),P=u(""),T=u(!1),q=async function(){w.value=!0,await I.auth.refreshSession(),w.value=!1},R=async function(){var s;if(y.value=!0,((s=t.user)==null?void 0:s.id)===void 0){alert("You must be logged in to save preferences.");return}const{error:f}=await I.from("profiles").update({first_name:k.value.trim(),last_name:S.value.trim()}).eq("id",t.user.id);f&&alert(`Error saving preference: ${f.message}`),t.loadProfile(),y.value=!1};return(f,s)=>(n(),l(b,null,[ee,e("form",{class:"flex flex-col p-4 md:min-w-96 md:items-center md:justify-center",onSubmit:s[2]||(s[2]=z(o=>R(),["prevent"]))},[e("div",te,[e("div",se,[j(e("input",{class:"my-2 h-12 rounded-md border border-gray-200 p-2",required:"",type:"text",placeholder:"First Name","onUpdate:modelValue":s[0]||(s[0]=o=>k.value=o)},null,512),[[C,k.value]]),j(e("input",{class:"my-2 h-12 rounded-md border border-gray-200 p-2",required:"",type:"text",placeholder:"Last Name","onUpdate:modelValue":s[1]||(s[1]=o=>S.value=o)},null,512),[[C,S.value]])]),e("div",oe,[x(E,{loading:y.value,dirty:!0},{default:D(()=>[m(" Save ")]),_:1},8,["loading"])]),e("div",le,[e("span",{class:B(T.value?"text-red-500":"text-neutral-700")},c(P.value),3)])])],32),ne,e("div",ae,[e("div",re,[ie,e("div",de,[x(O,{modelValue:N.value,"onUpdate:modelValue":s[3]||(s[3]=o=>N.value=o),table:"sqdc_suppliers",name_col:"supplier",value_col:"supplier"},null,8,["modelValue"])])])]),ue,e("div",ce,[e("div",fe,[x(E,{loading:w.value,dirty:!0,onClick:s[4]||(s[4]=o=>q())},{default:D(()=>[m(" Refresh Now ")]),_:1},8,["loading"])])]),g(p)?(n(),l("div",pe,[e("div",me,[_e,ve,e("div",null,[he,e("ul",null,[(n(!0),l(b,null,$(g(H).omit(g(h),"user","access_token"),(o,d)=>(n(),l("li",{key:d},[e("strong",null,c(d),1),m(": "+c(o),1)]))),128))]),ge,e("ul",null,[(n(!0),l(b,null,$(g(h).user,(o,d)=>(n(),l("li",{key:d},[e("strong",null,c(d),1),m(": "+c(o),1)]))),128))]),be,e("ul",null,[(n(!0),l(b,null,$(L.value,(o,d)=>(n(),l("li",{key:d},[e("strong",null,c(d),1),m(": "+c(o),1)]))),128))])])])])):J("",!0)],64))}});export{Se as default};
